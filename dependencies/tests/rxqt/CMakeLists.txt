project(RxQtTest LANGUAGES CXX)

include_directories(${COCR_INCLUDE_DIR})

set(CMAKE_AUTOMOC ON)

set(QT_COMPONENTS Test)
find_package(Qt5 COMPONENTS ${QT_COMPONENTS} REQUIRED)

set(PROJECT_SOURCE_DIR_LIST ./run_loop/ ./signal/)
list(LENGTH PROJECT_SOURCE_DIR_LIST PROJECT_SOURCE_DIR_LENGTH)
math(EXPR PROJECT_SOURCE_DIR_LOOP ${PROJECT_SOURCE_DIR_LENGTH}-1)

foreach (i RANGE ${PROJECT_SOURCE_DIR_LOOP})
    set(SUB_PROJECT_NAME ${PROJECT_NAME}_${i})
    list(GET PROJECT_SOURCE_DIR_LIST ${i} PROJECT_SOURCE_DIR)
    aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/${PROJECT_SOURCE_DIR} PROJECT_SOURCE_${i})
    add_executable(${SUB_PROJECT_NAME} ${PROJECT_SOURCE_${i}})

    set_target_properties(${SUB_PROJECT_NAME} PROPERTIES DEBUG_POSTFIX "d")

    set(QT_COMPONENT_TARGETS)
    foreach (QT_COMPONENT ${QT_COMPONENTS})
        list(APPEND QT_COMPONENT_TARGETS Qt5::${QT_COMPONENT})
    endforeach ()

    target_link_libraries(${SUB_PROJECT_NAME} ${QT_COMPONENT_TARGETS})

    add_test(NAME ${SUB_PROJECT_NAME} COMMAND ${CMAKE_CURRENT_BINARY_DIR}/${SUB_PROJECT_NAME}
            WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})
endforeach ()

